# 7. Нефункциональные требования

## 7.1. Производительность и масштабируемость

- Целевая нагрузка:
  - до 20 одновременных пользователей
  - до 1000 уникальных пользователей в месяц
- Обработка одного запроса к GPT не должна блокировать весь бот:
  - использовать async / await и отдельный слой для вызовов OpenAI API
- Возможность горизонтального масштабирования:
  - bot-процесс должен быть stateless (состояние — в БД и Redis/FSM storage, если нужно).

## 7.2. Надежность

- При падении одного контейнера:
  - система должна быть перезапущена orchestrator'ом (Docker / docker-compose / k8s в будущем).
- Все критичные операции (оплата, активация промокодов, отметка «я это съел»):
  - должны быть обернуты в транзакции БД.

## 7.3. Логирование и мониторинг

- Логировать:
  - входящие апдейты (без персональных данных больше минимума)
  - основные действия пользователя (анализ фото, изменения плана, покупки, активация промокодов)
  - ошибки интеграций (OpenAI, Telegram API, БД).
- В режиме дебага:
  - дополнительно логировать тела запросов/ответов OpenAI (с маскированием чувствительных данных).
- Возможность включения/отключения расширенного логирования через переменные окружения.

## 7.4. Безопасность

- Хранить токены Telegram Bot API и OpenAI API только в переменных окружения.
- Не логировать токены и чувствительные данные.
- Ограничить доступ к админ-командам /superadmin по списку Telegram ID администраторов.

## 7.5. Качество кода

- Использовать type hints (Python 3.10+).
- Соблюдать структуру проекта (разделение по слоям: handlers / services / repositories / prompts / locales).
- Добавить базовые тесты для:
  - лимитов
  - парсинга отчетов
  - работы FSM (как минимум smoke-тесты).
